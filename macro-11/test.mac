;
;  Test program to test various library routines.
;
	.INCLUDE /$COMMON.MAC/
	.INCLUDE /MACROS.MAC/
	.PSECT CODE,SAV,CON,GBL,I
	.TITLE TEST Program to test various libarary routines
	.IDENT	"X00.00"
	.ENABL GBL
;
	.SBTTL start - Entry point to print message
	text hello, <Macro-11 Test Program>
	text prompt, <CMD: >
	text dot, <.>
	string str, 80.
start::
	BIS #flglz+flgsgn, flgnum
	putsln #hello
;
cloop:	puts #prompt			; Ask for a string
	gets #str			; Get the string
	trim #str,ts=1,lz=1,ls=1	; Trim the string
	upcase #str
	sfindc #str, #32., R1
	substr #str, #cmd, #0, R1
;
;  Check for commands
;
	streq #cmd, #cexit		; Check for EXIT command
	BNE 100$
	JMP done
100$:	substr #str, #rest, R1, #0
	trim #rest, ls=1
;
	streq #cmd, #coct		; Check for OCTAL command
	BNE 101$
	JMP octal
;
101$:	streq #cmd, #cdec		; Check for DEC command
	BNE 102$
	JMP deci
;
102$:	streq #cmd, #chex		; Check for HEX command
	BNE 103$
	JMP hexi
;
103$:	streq #cmd #clist		; Check for LIST command
	BNE 104$
	JMP list
;
104$:	streq #cmd, #cstack		; Check for STACK command
	BNE 105$
	JMP estack
;
105$:	streq #cmd, #cerr		; Check for ERROR command
	BNE 106$
	JMP eerr
;
106$:	streq #cmd, #cname		; Check for NAME command
	BNE 107$
	JMP ename
;
107$:	streq #cmd, #csleep		;  Check for SLEEP command
	BNE 108$
	JMP esleep
;
108$:	streq #cmd, #cstar		;  Check for STAR command
	BNE 109$
	JMP estar
;
109$:	streq #cmd, #cfirqb		;  Check for FIRQB command
	BNE 110$
	JMP efirqb
;
110$:	streq #cmd, #cfqerr		;  Check for FQERR command
	BNE 111$
	JMP efqerr
;
111$:	streq #cmd, #cparsf		;  Check for PARSE command
	BNE 112$
	JMP eparsf
;
;  No recognized command given
;
112$:	cpstr #firstw, #outbuf
	appstr #cmd, #outbuf
	appstr #vbar, #outbuf
	putsln #outbuf
;
	cpstr #trest, #outbuf
	appstr #rest, #outbuf
	appstr #vbar, #outbuf
	putsln #outbuf
;
	strchr #str, #5, R0
	chrstr #temp, R0
	cpstr #msg2, #outbuf
	appstr #temp, #outbuf
	appstr #vbar, #outbuf
	putsln #outbuf
;
	upcase #str
	puts #msg2
	puts #str
	putsln #vbar		; Put the uppercase string
	locase #str
	puts #msg2
	puts #str
	putsln #vbar		; Put the lowercase string
;
	puts #msg4		; Print the string's max len
	strmax #str, R0
	putdec R0
	JSR PC, newline
	puts #msg5		; Print the string's actual len
	strlen #str, R0
	putdec R0
	JSR PC, newline
;
	JMP cloop
;
octal:	stroct #rest, R1
	JSR PC, putnm1
	JMP cloop
;
deci:	strdec #rest, R1
	JSR PC, putnm1
	JMP cloop
;
hexi:	strhex #rest, R1
	JSR PC, putnm1
	JMP cloop
;
eerr:	strdec #rest, R1
	geterr R1, #outbuf
	putsln #outbuf
	JMP cloop
;
ename:	setnam #rest
	JMP cloop
;
esleep:	strdec #rest, R1
	sleep R1
	JMP cloop
;
estar:	strdec #rest, R1
	repchr #str, #'*, R1
	puts #thestr
	puts #str
	putsln #vbar
	JMP cloop
;
estack:	MOV R0, -(SP)
	MOV SP, R0
	cpstr #tstack, #outbuf
	octstr #str, R0
	appstr #str, #outbuf
	putsln #outbuf
	MOV (SP)+, R0
	JMP cloop
;
	.SBTTL Loop - To print numbers
list:	BIC #flglz+flgsgn, flgnum
	cpstr #rest, #str
	sfindc #str, #32., R1
	substr #str, #cmd, #0, R1
	substr #str, #rest, R1, #0
	trim #cmd,ls=1
	trim #rest,ls=1
	strdec #cmd, R1
	strdec #rest, R0
;
1$:	JSR PC, putnm1
	INC R1
	SOB R0, 1$
	JMP cloop
;
efirqb:	cpstr #thestr, #outbuf
	cvtfqb #cfnam+cfext+cfppn+cfdev, #outbuf
	appstr #vbar, #outbuf
	putsln #outbuf
	JMP cloop
;
efqerr:	MOVB @#firqb, R0
	BIC #byteh, R0
	geterr R0, #outbuf
	putsln #outbuf
	JMP cloop
;
eparsf:	parsef #rest
	JMP cloop
;
done:	JMP exit
;	.EXIT
;
;  Prints a number in octal, decimal, or hex.  The number is
;  passed in R1.  This is done by building a string and then
;  printing it all at once.
;
	text sgnum, <  The signed number is >
	text unum,  <The unsigned number is >
	text oct, < Octal, >
	text dec, < Decimal, >
	text hex, < Hexidecimal.>
putnm1:	BIS #flgsgn, flgnum
	cpstr #sgnum, #outbuf
	octstr #temp, R1
	appstr #temp, #outbuf
	appstr #oct, #outbuf
	decstr #temp, R1
	appstr #temp, #outbuf
	appstr #dec, #outbuf
	hexstr #temp, R1
	appstr #temp, #outbuf
	appstr #hex, #outbuf
	putsln #outbuf
	TST R1
	BGE 1$
	BIC #flgsgn, flgnum
	cpstr #unum, #outbuf
	octstr #temp, R1
	appstr #temp, #outbuf
	appstr #oct, #outbuf
	decstr #temp, R1
	appstr #temp, #outbuf
	appstr #dec, #outbuf
	hexstr #temp, R1
	appstr #temp, #outbuf
	appstr #hex, #outbuf
	putsln #outbuf
1$:	RTS PC
;
	.SBTTL Data - Space for text messages and strings
	string outbuf, 80.
	string temp, 80.
	string cmd, 80.
	string rest, 80.
	text enttxt, <Enter text: >
	text msg2, <You entered: |>
	text vbar, <|>
	text msg4, <The string max len is: >
	text msg5, <The string length is:  >
	text thestr, <The string is |>
	text firstw, <The first word |>
	text trest, <The rest is |>
	text tstack, <Current SP is >
;
;  Text for commands
;
	text cexit, <EXIT>
	text coct, <OCTAL>
	text cdec, <DEC>
	text chex, <HEX>
	text clist, <LIST>
	text cstack, <STACK>
	text cerr, <ERROR>
	text cname, <NAME>
	text csleep, <SLEEP>
	text cstar, <STARS>
	text cfirqb, <FIRQB>
	text cfqerr, <FQERR>
	text cparsf, <PARSE>
;
	.END start
